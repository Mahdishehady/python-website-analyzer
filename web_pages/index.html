<!DOCTYPE html>
<html>
<head>
    <title>Highcharts Histogram</title>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
</head>
<body>
   <div class="row">
       <div id="container1" style="width: 50%"></div>
       <div id="container2" style="width: 50%"></div>
</div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Generate a random number between 1 and 30 for the URL parameter
            const randomDays = Math.floor(Math.random() * (20 - 5 + 1)) + 5;
            const apiUrl = `http://127.0.0.1:8000/getLastNews/${randomDays}`;

            // Make a GET request to the API
            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    return response.json(); // Parse the response as JSON
                })
                .then(data => {
                    const news = [];

                    // Convert data object to array for Highcharts
                    Object.entries(data).forEach(([key, value]) => {
                        news.push([key, value]);
                    });

                    console.log(news);
                    //Create pie chart
                    Highcharts.chart('container1', {
            chart: {
                type: 'column'
            },
            title: {
                text: `Aljazeera largest News Last ${randomDays} days`
            },
            subtitle: {
                text: ''
            },
            xAxis: {
                type: 'category',
                labels: {
                    autoRotation: [-45, -90],
                    style: {
                        fontSize: '13px',
                        fontFamily: 'Verdana, sans-serif'
                    }
                }
            },
            yAxis: {
                min: 0,
                title: {
                    text: 'News'
                }
            },
            legend: {
                enabled: false
            },
            tooltip: {
               pointFormat: 'News: <b>{point.y}</b>'
            },
            series: [{
                name: 'News',
                colors: [
                    '#9b20d9', '#9215ac', '#861ec9', '#7a17e6', '#7010f9', '#691af3',
                    '#6225ed', '#5b30e7', '#533be1', '#4c46db', '#4551d5', '#3e5ccf',
                    '#3667c9', '#2f72c3', '#277dbd', '#1f88b7', '#1693b1', '#0a9eaa',
                    '#03c69b', '#00f194'
                ],
                colorByPoint: true,
                groupPadding: 0,
                data: news ,
                dataLabels: {
                    enabled: true,
                    rotation: -90,
                    color: '#FFFFFF',
                    align: 'right',
                    format: '{point.y:.0f}', // one decimal
                    y: 10, // 10 pixels down from the top
                    style: {
                        fontSize: '13px',
                        fontFamily: 'Verdana, sans-serif'
                    }
                }
            }]
        });

                    // Create Highcharts histogram
                    Highcharts.chart('container2', {
                        chart: {
                            type: 'pie'
                        },
                        title: {
                            text: `Aljazeera largest News Last ${randomDays} days`
                        },
                        xAxis: {
                            type: 'category',
                            labels: {
                                autoRotation: [-45, -90],
                                style: {
                                    fontSize: '13px',
                                    fontFamily: 'Verdana, sans-serif'
                                }
                            }
                        },
                        yAxis: {
                            min: 0,
                            title: {
                                text: 'News Count'
                            }
                        },
                        legend: {
                            enabled: false
                        },
                        tooltip: {
                            pointFormat: 'News: <b>{point.y}</b>'
                        },
                        series: [{
                            name: 'News',
                            colorByPoint: true,
                            groupPadding: 0,
                            data: news,
                            dataLabels: {
                                enabled: true,
                                rotation: -90,
                                color: '#FFFFFF',
                                align: 'right',
                                format: '{point.y}', // Display as integer
                                y: 10,
                                style: {
                                    fontSize: '13px',
                                    fontFamily: 'Verdana, sans-serif'
                                }
                            }
                        }]
                    });
                })
                .catch(error => {
                    console.error('Fetch error:', error);
                });
        });
    </script>
</body>
</html>